function KeyMan(e){var t=this,n=this.getEl;return e||(e=document),this.downedKeyMap={},this.eventListMap={},this.keyMap={},this.downedKeyCount=0,this.shortcutInputObjs={},this.commanders={},n(e).addEventListener("keydown",function(e){var n=t.getKeyFromEvent(e);return null!=n&&(t.downedKeyMap[n]=!0),t.executeEvent("keydown",e),t.executeEvent("definedkeydown",n),t.executeEvent("pushshortcut",e),t.executeEvent("pushcommand",e),!0}),n(e).addEventListener("keyup",function(e){var n=t.getKeyFromEvent(e);return null!=n&&delete t.downedKeyMap[n],t.executeEvent("keyup",e),t.executeEvent("definedkeyup",n),t.executeEvent("pushshortcut",e),t.executeEvent("pushcommand",e),!0}),this}function KeyManCommander(e,t){this.superKeyMan=t,this.commanderName=e,this.downedDefinedKeyMap={},this.definedKeyMap={},this.definedKeydownFuncMap={},this.definedKeyupFuncMap={},this.definedKeyOrderList=[],this.standardDefinedKeyOrderList=[],this.isReversed=!1,this.lastDirection=null,this.lastBtn=null,this.timer=null,this.commandMap={},this.commandEventMap={},this.addCommand=function(e,t){return this.commandMap[e]=t,this},this.addCommandEvent=function(e,t){return this.commandEventMap[e]=t,this},this.addCommandMap=function(e){for(var t in e)this.commandMap[t]=e[t];return this},this.addCommandEventMap=function(e){for(var t in e)this.commandEventMap[t]=e[t];return this},this.defineKey=function(e,t,n,o){var i=this;if(n||(n=function(){}),o||(o=function(){}),this.definedKeydownFuncMap[e]=function(){i.downedDefinedKeyMap[e]=!0,n()},this.definedKeyupFuncMap[e]=function(){delete i.downedDefinedKeyMap[e],o()},t instanceof Array)for(var r=0;r<t.length;r++){var a=t[r];a=a.toUpperCase(),this.definedKeyMap[a]=e}else{var a=t;a=a.toUpperCase(),this.definedKeyMap[a]=e}},this.setUp=function(e,t,n){return this.defineKey(KeyMan.UP,e,t,n),this},this.setDown=function(e,t,n){return this.defineKey(KeyMan.DOWN,e,t,n),this},this.setLeft=function(e,t,n){return this.defineKey(KeyMan.LEFT,e,t,n),this},this.setRight=function(e,t,n){return this.defineKey(KeyMan.RIGHT,e,t,n),this},this.setButtonA=function(e,t,n){return this.defineKey(KeyMan.A,e,t,n),this},this.setButtonB=function(e,t,n){return this.defineKey(KeyMan.B,e,t,n),this},this.setButtonC=function(e,t,n){return this.defineKey(KeyMan.C,e,t,n),this},this.setButtonD=function(e,t,n){return this.defineKey(KeyMan.D,e,t,n),this},this.setReverse=function(e){return this.isReversed=e,this},this.handleDefinedKeydown=function(){var e=this;return function(t){var n=e.definedKeyMap[t],o=e.definedKeydownFuncMap[n];o&&o(),e.handleSaveKey(n)}},this.handleDefinedKeyup=function(){var e=this;return function(t){var n=e.definedKeyMap[t],o=e.definedKeyupFuncMap[n];o&&o(),e.handleSaveKey(n)}},this.getType=function(e){return"string"==typeof e?"btn":"direction"},this.handleSaveKey=function(e){var t,n,o,i,r=this,a=this.downedDefinedKeyMap;t=this.getDirectionCodeFromDownKeys(a,8),o=this.lastDirection==t,this.lastDirection=t,o||0==t||(this.definedKeyOrderList.push(t),this.isReversed&&(t=this.getReversedDirectionCodeList(t)),this.standardDefinedKeyOrderList.push(t)),n=this.getBtnCodeFromDownKeys(a),i=this.lastBtn==n,this.lastBtn=n,i||0==n||(this.definedKeyOrderList.push(n),this.standardDefinedKeyOrderList.push(n));var s=this.getMatchedCommand(this.standardDefinedKeyOrderList);!s||0==t&&0==n||(this.executeSkill(s),this.definedKeyOrderList=[],this.standardDefinedKeyOrderList=[]),0==t&&0==n||(clearTimeout(this.timer),this.timer=setTimeout(function(){r.definedKeyOrderList=[],r.standardDefinedKeyOrderList=[],r.lastDirection=null,r.lastBtn=null},300))},this.getMatchedCommand=function(e){var t={},n="",o=JSON.stringify(e);for(var i in this.commandMap){var r=JSON.stringify(this.commandMap[i]);r=r.substring(1,r.length-1),o.indexOf(r)!=-1&&(t[i]=r)}var a=Object.keys(t);if(1==a.length)n=a[0];else if(1<a.length){var s=0;for(var y in t)s<t[y].length&&(s=t[y].length,n=y)}return n},this.executeSkill=function(e){this.startSkill(e)},this.startSkill=function(e){var t=this.commandEventMap[e];t&&t()},this.serverReceiveSkill=function(e){},this.getDirectionCodeFromDownKeys=function(e,t){return 4==t||void 0===t?e[KeyMan.RIGHT]?KeyMan.RIGHT:e[KeyMan.LEFT]?KeyMan.LEFT:e[KeyMan.UP]?KeyMan.UP:e[KeyMan.DOWN]?KeyMan.DOWN:0:8==t?e[KeyMan.DOWN]&&e[KeyMan.RIGHT]?KeyMan.DOWNRIGHT:e[KeyMan.UP]&&e[KeyMan.RIGHT]?KeyMan.UPRIGHT:e[KeyMan.DOWN]&&e[KeyMan.LEFT]?KeyMan.DOWNLEFT:e[KeyMan.UP]&&e[KeyMan.LEFT]?KeyMan.UPLEFT:e[KeyMan.RIGHT]?KeyMan.RIGHT:e[KeyMan.LEFT]?KeyMan.LEFT:e[KeyMan.UP]?KeyMan.UP:e[KeyMan.DOWN]?KeyMan.DOWN:0:void 0},this.getReversedDirectionCodeList=function(e){return 4==e?6:6==e?4:7==e?9:9==e?7:1==e?3:3==e?1:e},this.getBtnCodeFromDownKeys=function(e){return e[KeyMan.A]?KeyMan.A:e[KeyMan.B]?KeyMan.B:e[KeyMan.C]?KeyMan.C:e[KeyMan.D]?KeyMan.D:0}}KeyMan.prototype.SHIFT="SHIFT",KeyMan.prototype.CTRL="CONTROL",KeyMan.prototype.ALT="ALT",KeyMan.prototype.ENTER="ENTER",KeyMan.prototype.ESC="ESCAPE",KeyMan.prototype.SPACE=" ",KeyMan.prototype.DELELTE="DELETE",KeyMan.prototype.BACKSPACE="BACKSPACE",KeyMan.prototype.INSERT="INSERT",KeyMan.prototype.HOME="HOME",KeyMan.prototype.END="END",KeyMan.prototype.PAGEDOWN="PAGEDOWN",KeyMan.prototype.PAGEDOWN="PAGEUP",KeyMan.prototype.DELELTE="BACKSPACE",KeyMan.prototype.HANGULMODE="HANGULMODE",KeyMan.prototype.HANJAMODE="HANJAMODE",KeyMan.prototype.N0="0",KeyMan.prototype.N1="1",KeyMan.prototype.N2="2",KeyMan.prototype.N3="3",KeyMan.prototype.N4="4",KeyMan.prototype.N5="5",KeyMan.prototype.N6="6",KeyMan.prototype.N7="7",KeyMan.prototype.N8="8",KeyMan.prototype.N9="9",KeyMan.prototype.F1="F1",KeyMan.prototype.F2="F2",KeyMan.prototype.F3="F3",KeyMan.prototype.F4="F4",KeyMan.prototype.F5="F5",KeyMan.prototype.F6="F6",KeyMan.prototype.F7="F7",KeyMan.prototype.F8="F8",KeyMan.prototype.F9="F9",KeyMan.prototype.F10="F10",KeyMan.prototype.F11="F11",KeyMan.prototype.F12="F12",KeyMan.prototype.keyCodeMap={8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",17:"CONTROL",18:"ALT",19:"PAUSE",20:"CAPSLOCK",27:"ESCAPE",32:" ",33:"PAGEUP",34:"PAGEDOWN",35:"END",36:"HOME",37:"ARROWLEFT",38:"ARROWUP",39:"ARROWRIGHT",40:"ARROWDOWN",45:"INSERT",46:"DELETE",144:"NUMBERLOCK",145:"SCROLLLOCK",186:";",187:"=",189:",",189:"-",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},KeyMan.prototype.rightKeyMap={CTRL:"CONTROL",ESC:"ESCAPE",DEL:"DELETE",SPACE:" ",UP:"ARROWUP",DOWN:"ARROWDOWN",RIGHT:"ARROWRIGHT",LEFT:"ARROWLEFT"},KeyMan.UP=8,KeyMan.DOWN=2,KeyMan.LEFT=4,KeyMan.RIGHT=6,KeyMan.DOWNRIGHT=3,KeyMan.DOWNLEFT=1,KeyMan.UPLEFT=7,KeyMan.UPRIGHT=9,KeyMan.A="A",KeyMan.B="B",KeyMan.C="C",KeyMan.D="D",KeyMan.prototype.convertToRightKeyFromKeys=function(e){for(var t,n,o=0;o<e.length;o++)n=e[o].toUpperCase(),t=this.rightKeyMap[n],e[o]=t?t:n;return e},KeyMan.prototype.getKeyFromEvent=function(e){var t,n=e.keyCode?e.keyCode:e.which,o=e.key?e.key:null;return 229==n?null:t=o?n&&48<=n&&n<=57?this.convertToKeyFromKeyCode(n):o.toUpperCase():this.convertToKeyFromKeyCode(n).toUpperCase()},KeyMan.prototype.convertToKeyFromKeyCode=function(e){var t="";return t+=this.keyCodeMap[e]?this.keyCodeMap[e]:65<=e&&e<=90?String.fromCharCode(e):96==e?0:97<=e&&e<=105?e-96:112<=e&&e<=123?"F"+(e-111):String.fromCharCode(e)},KeyMan.prototype.convertToKeyCodesFrom=function(e){for(var t=[],n=0;n<e.length;n++){var o=e[n];"string"==typeof o&&(o=o.charCodeAt(0)),t.push(o)}return t},KeyMan.prototype.isOnKey=function(e){return this.downedKeyMap[e.toUpperCase()]},KeyMan.prototype.checkKey=function(e){e=e.toUpperCase();var t=this.isOnKey(e);return delete this.downedKeyMap[e],t},KeyMan.prototype.clearKeyDownedMap=function(){for(var e in this.downedKeyMap)delete this.downedKeyMap[e]},KeyMan.prototype.addEventListener=function(e,t){this.eventListMap[e]||(this.eventListMap[e]=[]),this.eventListMap[e].push(t)},KeyMan.prototype.removeEventListener=function(e,t){var n=this.eventListMap[e];if(t){if(n&&n.length>0)for(var o=0;o<n.length;o++)t==n[o]&&n.splice(o,1)}else delete this.eventListMap[e]},KeyMan.prototype.executeEvent=function(e,t){var n=this.eventListMap[e];if(n)for(var o=0;o<n.length;o++)n[o](t)},KeyMan.prototype.isOn=function(e){var t=this.keyMap[e];return t&&t.isPressed},KeyMan.prototype.check=function(e){var t=this.isOn(e);if(t){var n=this.keyMap[e];n.keyup&&n.keyup(),n.isPressed=!1}return this.clearKeyDownedMap(),t},KeyMan.prototype.addShortcut=function(e){var t=this,n=e.name,o=this.convertToRightKeyFromKeys(e.keys),i=e.keydown,r=e.keypress,a=e.keyup,s=function(e){for(var a=0;a<o.length;a++)if(!t.isOnKey(o[a]))return t.keyMap[n].isPressed=!1,!1;var s=t.keyMap[n].data;return t.keyMap[n].isPressed||(t.keyMap[n].isPressed=!0,i&&i(s)),r&&r(s),!0},y=function(e){for(var i=0;i<o.length;i++)if(!t.isOnKey(o[i])){var r=t.keyMap[n].data;if(t.keyMap[n].isPressed)return t.keyMap[n].isPressed=!1,a&&a(r),!0}return!1};return n&&(this.keyMap[n]=e,this.keyMap[n].keydownImpl=s,this.keyMap[n].keyupImpl=y,this.keyMap[n].isPressed=!1),this.addEventListener("keydown",s),this.addEventListener("keyup",y),this},KeyMan.prototype.delShortcut=function(e){var t=this.keyMap[e];if(t){for(var n=["keydown","keyup"],o=0;o<n.length;o++){var i=n[o],r=n[o]+"Impl";t[r]&&this.removeEventListener(i,t[r])}delete this.keyMap[e]}return this},KeyMan.prototype.addCommand=function(e){this.addEventListener("saveCommand",plusFuncKeyDown)},KeyMan.prototype.delCommand=function(e){},KeyMan.prototype.lock=function(){},KeyMan.prototype.unlock=function(){},KeyMan.prototype.stop=function(){},KeyMan.prototype.start=function(){},KeyMan.prototype.detect=function(){var e=this;return getEl().ready(function(){tempEls=document.querySelectorAll("[data-shortcut-input]");for(var t=0;t<tempEls.length;t++)e.addShortcutInput(tempEls[t]);tempEls=document.querySelectorAll("[data-command-input]");for(var t=0;t<tempEls.length;t++)e.addShortcutInput(tempEls[t])}),this},KeyMan.prototype.addShortcutInput=function(e,t){t=t?t:{};var n=this,o=this.shortcutInputObjs,i=t.manid?t.manid:getEl(o).getNewSeqId("tmpKeyList");e.manid=i,this.shortcutInputObjs[i]=t,this.shortcutInputObjs[i].el=e,this.shortcutInputObjs[i].manid=i;var r=function(t){n.setShortcutInputValue(e,t," + ")};return getEl(e).addEventListener("focus",function(e){for(var t in n.downedKeyMap)delete n.downedKeyMap[t];n.startPushShortcutInputValue(r)}),getEl(e).addEventListener("blur",function(e){for(var t in n.downedKeyMap)delete n.downedKeyMap[t];n.stopPushShortcutInputValue(r)}),i},KeyMan.prototype.getShortcutInputById=function(e){var t=document.getElementById(e);return this.shortcutInputObjs[t.manid].keyList},KeyMan.prototype.getShortcutInputByManId=function(e){return this.shortcutInputObjs[e].keyList},KeyMan.prototype.setShortcutInputValue=function(e,t,n){n=n?n:" + ";var o=this.sortKeyList(t);e.value=null!=t?o.join(n):"";var i=e.manid;i&&(this.shortcutInputObjs[i].keyList=o)},KeyMan.prototype.sortKeyList=function(e){var t=["CONTROL","ALT","SHIFT"],n=e.sort(function(e,n){var o=t.indexOf(e),i=t.indexOf(n);return o!=-1&&o<i?0:i!=-1?1:-1});return n},KeyMan.prototype.startPushShortcutInputValue=function(e){var t=this,n=function(n){n.returnValue=!1;var o=Object.keys(t.downedKeyMap),i=t.downedKeyCount,r=o.length;return t.downedKeyCount=r,i<r&&e(o),!0};return this.addEventListener("pushshortcut",n),this},KeyMan.prototype.stopPushShortcutInputValue=function(){return this.removeEventListener("pushshortcut"),this},KeyMan.prototype.addCommandInput=function(e,t){t=t?t:{};var n=this,o=this.commandInputObjs,i=t.manid?t.manid:getEl(o).getNewSeqId("tmpKeyList");e.manid=i,this.commandInputObjs[i]=t,this.commandInputObjs[i].el=e,this.commandInputObjs[i].manid=i;var r=function(t){n.setCommandInputValue(e,t," + ")};return getEl(e).addEventListener("focus",function(e){for(var t in n.downedKeyMap)delete n.downedKeyMap[t];n.startPushCommandInputValue(r)}),getEl(e).addEventListener("blur",function(e){for(var t in n.downedKeyMap)delete n.downedKeyMap[t];n.stopPushCommandInputValue(r)}),i},KeyMan.prototype.getCommandInputById=function(e){var t=document.getElementById(e);return this.commandInputObjs[t.manid].keyList},KeyMan.prototype.getCommandInputByManId=function(e){return this.commandInputObjs[e].keyList},KeyMan.prototype.setCommandInputValue=function(e,t,n){n=n?n:" + ";var o=this.sortKeyList(t);e.value=null!=t?o.join(n):"";var i=e.manid;i&&(this.commandInputObjs[i].keyList=o)},KeyMan.prototype.startPushCommandInputValue=function(e){var t=this,n=function(n){n.returnValue=!1;var o=Object.keys(t.downedKeyMap),i=t.downedKeyCount,r=o.length;return t.downedKeyCount=r,i<r&&e(o),!0};return this.addEventListener("pushcommand",n),this},KeyMan.prototype.stopPushCommandInputValue=function(){return this.removeEventListener("pushcommand"),this},KeyMan.prototype.addCommander=function(e){var t;return this.commanders[e]||(t=new KeyManCommander(e,this),t.definedKeydownFunc=t.handleDefinedKeydown(),t.definedKeyupFunc=t.handleDefinedKeyup(),this.commanders[e]=t,this.addEventListener("definedkeydown",t.definedKeydownFunc),this.addEventListener("definedkeyup",t.definedKeyupFunc)),t},KeyMan.prototype.getCommander=function(e){return this.commanders[e]},KeyMan.prototype.delCommander=function(e){var t=this.commanders,n=t[e];return this.removeEventListener("definedkeydown",n.definedKeydownFunc),this.removeEventListener("definedkeyup",n.definedKeyupFunc),delete t[e],this},KeyMan.prototype.getEl=function(e){var t="object"==typeof e?e:document.getElementById(e),n={addEventListener:function(e,n){return navigator.userAgent.indexOf("Firefox")!=-1&&t.addEventListener(e,function(e){window.event=e},!0),t.addEventListener?t.addEventListener(e,function(e){n(e)}):t.attachEvent("on"+e,function(e){!e.target&&e.srcElement&&(e.target=e.srcElement),n(e)}),!0}};return n};