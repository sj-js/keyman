<!DOCTYPE html>
<HTML>
    <head>
        <meta charset="utf-8" />
        <meta name=viewport content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no" />
        <script src="../../crossman/src/js/crossman.js"></script>
        <link rel=stylesheet href="../src/css/keyman-view.css">
        <script src="../src/js/keyman.js"></script>
        <script src="../src/js/keyman-keyhandler-shortcut.js"></script>
        <script src="../src/js/keyman-keyhandler-command.js"></script>
        <script src="../src/js/keyman-keyhandler-typing.js"></script>
        <script src="../src/js/keyman-view.js"></script>
        <style>
            * { margin:0; }
            /*div:focus { background-color: Aqua; }*/
        </style>
    </head>

    <script>
        ready(function(){
            showKeyMapView();
            showKeyInputView();
        });
        var keyman = new KeyMan();
        var keymanView = new KeyMan.View(keyman);
        keyman
                // .addEventListener('shortcutkeydown', function(eventData){
                //     if (!eventData.keyStepList)
                //         return;
                //     //Shortcut
                //     getEl('div-show-shortcut').html('');
                //     // KeyMan.View.generateShortcutViewForKeyStepList(keyStepList).appendTo('div-show-command');
                //     KeyMan.View.generateCommandViewForKeyStepList(eventData.keyStepList).appendTo('div-show-shortcut');
                // })
                // .addEventListener('shortcutkeyup', function(eventData){
                // })
                // .addEventListener('commandkeydown', function(eventData){
                //     if (!eventData.keyStepList)
                //         return;
                //     //Command
                //     getEl('div-show-command').html('');
                //     KeyMan.View.generateCommandViewForKeyStepList(eventData.keyStepList).appendTo('div-show-command');
                // })
                // .addEventListener('commandkeyup', function(eventData){
                // })
                // .addEventListener('addedkey', function(eventData){
                //     console.error('addedkey!!', eventData);
                //     showKeyMapView();
                // })
                // .addEventListener('modifiedkey', function(eventData){
                //     console.error('modifiedkey!!', eventData);
                //     showKeyMapView();
                // })
                // .addEventListener('removedkey', function(eventData){
                //     console.error('removedkey!!', eventData);
                //     showKeyMapView();
                // })
                // .addEventListener('addedmap', function(eventData){
                //     console.error('addedmap!!', eventData);
                //     showKeyMapView();
                // })
                // .addEventListener('modifiedoption', function(eventData){
                //     console.error('modifiedoption!!', eventData);
                //     showKeyMapView();
                // })
                // .addEventListener('modifiedmap', function(eventData){
                //     console.error('modifiedmap!!', eventData);
                //     showKeyMapView();
                // })
                // .addEventListener('removedmap', function(eventData){
                //     console.error('removedmap!!', eventData);
                //     showKeyMapView();
                // })
                .addEventListener('execute', function(eventData){
                    console.error('execute!!', eventData);
                    var functionKey = eventData.functionKey
                    var runner = eventData.runner;
                    var data = eventData.data;
                    if (runner !== null){
                        if (typeof runner == 'string'){
                            if (runner){
                                var func = new Function('data', runner);
                                func(data);
                            }else{
                                runByCode(runner, data);
                            }
                        }else if (runner instanceof Function){
                            runner(data);
                        }
                    }
                    //- OR
                    keyman.getRunnerPool().run(runner, data);
                })
                .addEventListener('untypeable', function(eventData){
                    getEl('div-show-signal').setStyle('color', 'red');
                })
                .addEventListener('typeable', function(eventData){
                    getEl('div-show-signal').setStyle('color', 'green');
                });
        keyman.getUser().setModeAutoSave(true).load();
        keyman
            .add({
                name: 'tool-setup',
                keys: [['ctrl', 'alt', 'shift', 's']],
                execute: function(e){
                    keymanView.generatePopViewForKeyManSetup(keyman.getUser()).appendTo(document.body);
                }
            })
            .add({
                name: 'tool-setup',
                keys: [['ctrl', 'shift', 'e']],
                execute: function(e){
                    // keymanView.exportData();
                }
            })
            .add({
                name: 'tool-setup',
                keys: [['ctrl', 'shift', 'i']],
                execute: function(e){
                    // keymanView.importData();
                }
            })
            .add({
                name: 'add-key',
                keys: [['ctrl'], ['a'], ['d'], ['d']],
                execute: function(e){
                    var currentKeyMap = keymanView.getCurrentKeyMap();
                    if (!currentKeyMap)
                        return;
                    keymanView.generatePopViewForKeyProperties(currentKeyMap).appendTo(document.body);
                }
            });

        // keyman.add({
        //     name:'develop-tool',
        //     title: 'Open temporal view',
        //     keys: ['ctrl', 'shift'],
        //     runner: 'A',
        //     keydown: function(event){
        //         document.getElementById('tester').innerHTML = 'KEY ON';
        //     },
        //     keyup: function(event){
        //         document.getElementById('tester').innerHTML = 'KEY OFF';
        //     }
        // });
        //
        // keyman.add({
        //     name:'copy-then',
        //     title: 'copy something blahblah',
        //     keys: ['ctrl', 'c'],
        //     runner: 'B',
        //     keydown: function(event){
        //         document.getElementById('tester').innerHTML = 'COPY ON';
        //     },
        //     keyup: function(event){
        //         document.getElementById('tester').innerHTML = 'COPY AND..';
        //     }
        // });
        // // keyman.remove('copy-then');
        //
        // keyman.add({
        //     name:'open-tool-simplely',
        //     title: 'Open finder',
        //     keys: [['shift'], ['shift']],
        //     runner: 'B',
        //     keydown: function(event){
        //         document.getElementById('tester').innerHTML = 'Simple Open Tool Down';
        //     },
        //     keyup: function(event){
        //         document.getElementById('tester').innerHTML = 'Simple Open Tool Up';
        //     }
        // });
        //
        //
        // keyman.add({
        //     name:'test-simplely',
        //     title: 'Welcome to SJJS',
        //     keys: [['s'], ['j'], ['j'], ['s']],
        //     runner: 'C',
        //     keydown: function(event){
        //         document.getElementById('tester').innerHTML = 'Simple Test Down';
        //     },
        //     keyup: function(event){
        //         document.getElementById('tester').innerHTML = 'Simple Test Up';
        //     }
        // });
        // keyman.remove({name: 'test-simplely'});

        keyman.getRunnerPool()
            .add({id: 'A', title: 'A 123asdf', execute: function(data){
                console.error('A');
            }})
            .add({id: 'B', title: 'B 123asdf', execute: function(data){
                console.error('B');
            }})
            .add({id: 'C', title: 'C asd434f', execute: function(data){
                console.error('C');
            }});

        keyman.getRunnerPool().getRunnerMap();
        keyman.getRunnerPool().run('123', {a:1, b:2});


        function showKeyMapView(){
            getEl('div-tool-key-map').exists(function(it){
                it.html('').add( keymanView.generateKeyManViewContext(keyman.getUser()) );
            });
            // getEl('div-show-key-map').exists(function(it){
            //     it.html('');
            //     var data = keyman.getSystem().get('_default').extractData();
            //     keymanView.generateTableViewForKeyMap( data ).appendTo('div-show-key-map');
            //     keymanView.generateButtonViewForKeyAdditionButton().appendTo('div-show-key-map');
            // });
        }

        function showKeyInputView(){
            keymanView.generateKeyInputView(keyman).appendTo('div-key-input-view');
        }
    </script>

    <body>
        <div id="div-key-input-view" class="light-keys" style="position:absolute; top:0px; left:0px;">

        </div>

        <div id="div-tool-key-map" class="light-keys" style="max-width:500px;">
        </div>

        <div id="tester" style="color:#FF832C; font-weight:bold;">
            TEST...
        </div>

        <div id="div-show-signal" class="" style="color:grey;">
            ‚óè
        </div>

<!--        <div id="div-show-shortcut" class="show-pannel light-keys">-->
<!--        </div>-->
<!--        <br/>-->

<!--        <div id="div-show-command" class="show-pannel light-keys">-->
<!--        </div>-->
<!--        <br/>-->

<!--        <div class="">-->
<!--            <input id="input1" data-shortcut-input type="text"  /><br/>-->
<!--            <input id="input2" data-shortcut-input type="text"  /><br/>-->
<!--        </div>-->
    </body>

</HTML>