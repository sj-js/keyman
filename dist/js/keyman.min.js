function KeyMan(e){var t=this;return this.event=new SjEvent,e||(e=document),this.downedKeyMap={},this.eventListMap={},this.keyMap={},this.downedKeyCount=0,this.shortcutInputObjs={},this.commandInputObjs={},this.commanders={},e.addEventListener("keydown",function(e){var n=t.getKeyFromEvent(e);return null!=n&&(t.downedKeyMap[n]=!0),t.execEventListenerByEventName("keydown",e),t.execEventListenerByEventName("keydownforcommand",n),t.execEventListenerByEventName("pushshortcut",e),!0}),e.addEventListener("keyup",function(e){var n=t.getKeyFromEvent(e);return null!=n&&delete t.downedKeyMap[n],t.execEventListenerByEventName("keyup",e),t.execEventListenerByEventName("keyupforcommand",n),t.execEventListenerByEventName("pushshortcut",e),!0}),this}function KeyManCommander(e){this.parent=null,this.commanderName=e,this.downedDefinedKeyMap={},this.definedKeyMap={},this.definedKeydownFuncMap={},this.definedKeyupFuncMap={},this.definedKeyOrderList=[],this.standardDefinedKeyOrderList=[],this.funcEventWhenCommand=null,this.isReversed=!1,this.lastDirection=null,this.lastBtn=null,this.timer=null,this.commandMap={},this.commandEventMap={},this.addCommand=function(e,t){return this.commandMap[e]=t,this},this.addCommandEvent=function(e,t){return this.commandEventMap[e]=t,this},this.addCommandMap=function(e){for(var t in e)this.commandMap[t]=e[t];return this},this.addCommandEventMap=function(e){for(var t in e)this.commandEventMap[t]=e[t];return this},this.defineKey=function(e,t,n,r){var a=this;if(n||(n=function(){}),r||(r=function(){}),this.definedKeydownFuncMap[e]=function(){a.downedDefinedKeyMap[e]=!0,n()},this.definedKeyupFuncMap[e]=function(){delete a.downedDefinedKeyMap[e],r()},t instanceof Array)for(var i=0;i<t.length;i++){var o=t[i];o=o.toUpperCase(),this.definedKeyMap[o]=e}else{var o=t;o=o.toUpperCase(),this.definedKeyMap[o]=e}},this.setUp=function(e,t,n){return this.defineKey(KeyMan.UP,e,t,n),this},this.setDown=function(e,t,n){return this.defineKey(KeyMan.DOWN,e,t,n),this},this.setLeft=function(e,t,n){return this.defineKey(KeyMan.LEFT,e,t,n),this},this.setRight=function(e,t,n){return this.defineKey(KeyMan.RIGHT,e,t,n),this},this.setButtonA=function(e,t,n){return this.defineKey(KeyMan.A,e,t,n),this},this.setButtonB=function(e,t,n){return this.defineKey(KeyMan.B,e,t,n),this},this.setButtonC=function(e,t,n){return this.defineKey(KeyMan.C,e,t,n),this},this.setButtonD=function(e,t,n){return this.defineKey(KeyMan.D,e,t,n),this},this.setReverse=function(e){return this.isReversed=e,this},this.handleDefinedKeydown=function(){var e=this;return function(t){var n=e.definedKeyMap[t],r=e.definedKeydownFuncMap[n];r&&r(),e.handleSaveDefinedKey(n)}},this.handleDefinedKeyup=function(){var e=this;return function(t){var n=e.definedKeyMap[t],r=e.definedKeyupFuncMap[n];r&&r(),e.handleSaveDefinedKey(n)}},this.handleKeydown=function(){var e=this;return function(t){var n=e.definedKeydownFuncMap[t];n?n():e.downedDefinedKeyMap[t]=!0,e.handleSaveKey(t)}},this.handleKeyup=function(){var e=this;return function(t){var n=e.definedKeyupFuncMap[t];n?n():delete e.downedDefinedKeyMap[t],e.handleSaveKey(t)}},this.getType=function(e){return"string"==typeof e?"btn":"direction"},this.handleSaveKey=function(e){var t=this,n=this.downedDefinedKeyMap;e=Object.keys(n)[0];var r=this.lastDirection==e;if(this.lastDirection=e,null!==e&&void 0!==e&&(r||(this.definedKeyOrderList.push(e),this.standardDefinedKeyOrderList.push(e))),this.funcEventWhenCommand&&this.funcEventWhenCommand(this.standardDefinedKeyOrderList),null!==e&&void 0!==e){var a=this.getMatchedCommand(this.standardDefinedKeyOrderList);a&&(this.executeSkill(a),this.definedKeyOrderList=[],this.standardDefinedKeyOrderList=[]),clearTimeout(this.timer),this.timer=setTimeout(function(){t.clearDefinedKey(t)},300)}},this.handleSaveDefinedKey=function(e){var t,n,r,a,i=this,o=this.downedDefinedKeyMap;if(t=this.getDirectionCodeFromDownKeys(o,8),r=this.lastDirection==t,this.lastDirection=t,r||0==t||(this.definedKeyOrderList.push(t),this.isReversed&&(t=this.getReversedDirectionCodeList(t)),this.standardDefinedKeyOrderList.push(t)),n=this.getBtnCodeFromDownKeys(o),a=this.lastBtn==n,this.lastBtn=n,a||0==n||(this.definedKeyOrderList.push(n),this.standardDefinedKeyOrderList.push(n)),this.funcEventWhenCommand&&this.funcEventWhenCommand(this.standardDefinedKeyOrderList),0!=t||0!=n){var y=this.getMatchedCommand(this.standardDefinedKeyOrderList);y&&(this.executeSkill(y),this.definedKeyOrderList=[],this.standardDefinedKeyOrderList=[]),clearTimeout(this.timer),this.timer=setTimeout(function(){i.clearDefinedKey(i)},300)}},this.clearDefinedKey=function(){this.downedDefinedKeyMap={},this.definedKeyOrderList=[],this.standardDefinedKeyOrderList=[],this.lastDirection=null,this.lastBtn=null},this.getMatchedCommand=function(e){var t={},n="",r=JSON.stringify(e);for(var a in this.commandMap){var i=JSON.stringify(this.commandMap[a]);i=i.substring(1,i.length-1),r.indexOf(i)!=-1&&(t[a]=i)}var o=Object.keys(t);if(1==o.length)n=o[0];else if(1<o.length){var y=0;for(var s in t)y<t[s].length&&(y=t[s].length,n=s)}return n},this.executeSkill=function(e){this.startSkill(e)},this.startSkill=function(e){var t=this.commandEventMap[e];t&&t()},this.serverReceiveSkill=function(e){},this.getDirectionCodeFromDownKeys=function(e,t){return 4==t||void 0===t?e[KeyMan.RIGHT]?KeyMan.RIGHT:e[KeyMan.LEFT]?KeyMan.LEFT:e[KeyMan.UP]?KeyMan.UP:e[KeyMan.DOWN]?KeyMan.DOWN:0:8==t?e[KeyMan.DOWN]&&e[KeyMan.RIGHT]?KeyMan.DOWNRIGHT:e[KeyMan.UP]&&e[KeyMan.RIGHT]?KeyMan.UPRIGHT:e[KeyMan.DOWN]&&e[KeyMan.LEFT]?KeyMan.DOWNLEFT:e[KeyMan.UP]&&e[KeyMan.LEFT]?KeyMan.UPLEFT:e[KeyMan.RIGHT]?KeyMan.RIGHT:e[KeyMan.LEFT]?KeyMan.LEFT:e[KeyMan.UP]?KeyMan.UP:e[KeyMan.DOWN]?KeyMan.DOWN:0:void 0},this.getReversedDirectionCodeList=function(e){return 4==e?6:6==e?4:7==e?9:9==e?7:1==e?3:3==e?1:e},this.getBtnCodeFromDownKeys=function(e){return e[KeyMan.A]?KeyMan.A:e[KeyMan.B]?KeyMan.B:e[KeyMan.C]?KeyMan.C:e[KeyMan.D]?KeyMan.D:0}}try{var crossman=require("@sj-js/crossman"),ready=crossman.ready,getEl=crossman.getEl,newEl=crossman.newEl,getData=crossman.getData,SjEvent=crossman.SjEvent}catch(e){}try{module.exports=exports=KeyMan}catch(e){}KeyMan.prototype.SHIFT="SHIFT",KeyMan.prototype.CTRL="CONTROL",KeyMan.prototype.ALT="ALT",KeyMan.prototype.ENTER="ENTER",KeyMan.prototype.ESC="ESCAPE",KeyMan.prototype.SPACE=" ",KeyMan.prototype.DELELTE="DELETE",KeyMan.prototype.BACKSPACE="BACKSPACE",KeyMan.prototype.INSERT="INSERT",KeyMan.prototype.HOME="HOME",KeyMan.prototype.END="END",KeyMan.prototype.PAGEDOWN="PAGEDOWN",KeyMan.prototype.PAGEDOWN="PAGEUP",KeyMan.prototype.HANGULMODE="HANGULMODE",KeyMan.prototype.HANJAMODE="HANJAMODE",KeyMan.prototype.N0="0",KeyMan.prototype.N1="1",KeyMan.prototype.N2="2",KeyMan.prototype.N3="3",KeyMan.prototype.N4="4",KeyMan.prototype.N5="5",KeyMan.prototype.N6="6",KeyMan.prototype.N7="7",KeyMan.prototype.N8="8",KeyMan.prototype.N9="9",KeyMan.prototype.F1="F1",KeyMan.prototype.F2="F2",KeyMan.prototype.F3="F3",KeyMan.prototype.F4="F4",KeyMan.prototype.F5="F5",KeyMan.prototype.F6="F6",KeyMan.prototype.F7="F7",KeyMan.prototype.F8="F8",KeyMan.prototype.F9="F9",KeyMan.prototype.F10="F10",KeyMan.prototype.F11="F11",KeyMan.prototype.F12="F12",KeyMan.prototype.keyCodeMap={8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",17:"CONTROL",18:"ALT",19:"PAUSE",20:"CAPSLOCK",27:"ESCAPE",32:" ",33:"PAGEUP",34:"PAGEDOWN",35:"END",36:"HOME",37:"ARROWLEFT",38:"ARROWUP",39:"ARROWRIGHT",40:"ARROWDOWN",45:"INSERT",46:"DELETE",144:"NUMBERLOCK",145:"SCROLLLOCK",186:";",187:"=",189:",",189:"-",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},KeyMan.prototype.rightKeyMap={CTRL:"CONTROL",ESC:"ESCAPE",DEL:"DELETE",SPACE:" ",UP:"ARROWUP",DOWN:"ARROWDOWN",RIGHT:"ARROWRIGHT",LEFT:"ARROWLEFT"},KeyMan.UP=8,KeyMan.DOWN=2,KeyMan.LEFT=4,KeyMan.RIGHT=6,KeyMan.DOWNRIGHT=3,KeyMan.DOWNLEFT=1,KeyMan.UPLEFT=7,KeyMan.UPRIGHT=9,KeyMan.A="A",KeyMan.B="B",KeyMan.C="C",KeyMan.D="D",KeyMan.SHIFT="SHIFT",KeyMan.CTRL="CONTROL",KeyMan.ALT="ALT",KeyMan.ENTER="ENTER",KeyMan.ESC="ESCAPE",KeyMan.SPACE=" ",KeyMan.DELELTE="DELETE",KeyMan.BACKSPACE="BACKSPACE",KeyMan.INSERT="INSERT",KeyMan.HOME="HOME",KeyMan.END="END",KeyMan.PAGEDOWN="PAGEDOWN",KeyMan.PAGEDOWN="PAGEUP",KeyMan.HANGULMODE="HANGULMODE",KeyMan.HANJAMODE="HANJAMODE",KeyMan.N0="0",KeyMan.N1="1",KeyMan.N2="2",KeyMan.N3="3",KeyMan.N4="4",KeyMan.N5="5",KeyMan.N6="6",KeyMan.N7="7",KeyMan.N8="8",KeyMan.N9="9",KeyMan.F1="F1",KeyMan.F2="F2",KeyMan.F3="F3",KeyMan.F4="F4",KeyMan.F5="F5",KeyMan.F6="F6",KeyMan.F7="F7",KeyMan.F8="F8",KeyMan.F9="F9",KeyMan.F10="F10",KeyMan.F11="F11",KeyMan.F12="F12",KeyMan.prototype.detect=function(e){var t=this;return ready(function(){var n;n=document.querySelectorAll("[data-shortcut-input]");for(var r=0;r<n.length;r++)t.addShortcutInput(n[r]);n=document.querySelectorAll("[data-command-input]");for(var r=0;r<n.length;r++)t.addCommandInput(n[r]);e&&e(t),t.hasEventListenerByEventName("afterdetect")&&t.execEventListenerByEventName("afterdetect")}),this},KeyMan.prototype.afterDetect=function(e){return this.addEventListenerByEventName("afterdetect",e),this},KeyMan.prototype.addEventListener=function(e,t,n){return this.event.addEventListener(e,t,n)},KeyMan.prototype.addEventListenerByEventName=function(e,t){return this.event.addEventListenerByEventName(e,t)},KeyMan.prototype.hasEventListener=function(e,t,n){return this.event.hasEventListener(e,t,n)},KeyMan.prototype.hasEventListenerByEventName=function(e,t){return this.event.hasEventListenerByEventName(e,t)},KeyMan.prototype.hasEventListenerByEventFunc=function(e){return this.event.hasEventListenerByEventFunc(e)},KeyMan.prototype.removeEventListener=function(e,t,n){return this.event.removeEventListener(e,t,n)},KeyMan.prototype.removeEventListenerByEventName=function(e,t){return this.event.removeEventListenerByEventName(e,t)},KeyMan.prototype.removeEventListenerByEventFunc=function(e){return this.event.removeEventListenerByEventFunc(e)},KeyMan.prototype.execEventListener=function(e,t,n){return this.event.execEventListener(e,t,n)},KeyMan.prototype.execEventListenerByEventName=function(e,t){return this.event.execEventListenerByEventName(e,t)},KeyMan.prototype.convertToRightKeyFromKeys=function(e){var t,n;"string"==typeof e&&(e=this.parse(e));for(var r=0;r<e.length;r++)n=e[r].toUpperCase(),t=this.rightKeyMap[n],e[r]=t?t:n;return e},KeyMan.prototype.parse=function(e){var t=[];if("string"==typeof e)for(var n,r=e.split(/\s[+]\s/),a=0;a<r.length;a++)n=r[a],t.push(n);return t},KeyMan.prototype.convertToKeyExpression=function(e){var t="";return e instanceof Array&&(t=e.join(" + ")),t},KeyMan.prototype.getKeyFromEvent=function(e){var t,n=e.keyCode?e.keyCode:e.which,r=e.key?e.key:null;return 229==n?null:t=r?n&&48<=n&&n<=57?this.convertToKeyFromKeyCode(n):r.toUpperCase():this.convertToKeyFromKeyCode(n).toUpperCase()},KeyMan.prototype.convertToKeyFromKeyCode=function(e){var t="";return t+=this.keyCodeMap[e]?this.keyCodeMap[e]:65<=e&&e<=90?String.fromCharCode(e):96==e?0:97<=e&&e<=105?e-96:112<=e&&e<=123?"F"+(e-111):String.fromCharCode(e)},KeyMan.prototype.convertToKeyCodesFrom=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];"string"==typeof r&&(r=r.charCodeAt(0)),t.push(r)}return t},KeyMan.prototype.isOnKey=function(e){return this.downedKeyMap[e.toUpperCase()]},KeyMan.prototype.checkKey=function(e){e=e.toUpperCase();var t=this.isOnKey(e);return delete this.downedKeyMap[e],t},KeyMan.prototype.clearKeyDownedMap=function(){for(var e in this.downedKeyMap)delete this.downedKeyMap[e]},KeyMan.prototype.clearCommanderKey=function(){var e=this.commanders;for(var t in e){var n=e[t];n.clearDefinedKey()}return this},KeyMan.prototype.isOn=function(e){var t=this.keyMap[e];return t&&t.isPressed},KeyMan.prototype.check=function(e){var t=this.isOn(e);if(t){var n=this.keyMap[e];n.keyup&&n.keyup(),n.isPressed=!1}return this.clearKeyDownedMap(),this.clearCommanderKey(),t},KeyMan.prototype.addShortcut=function(e){var t=this,n=e.name,r=this.convertToRightKeyFromKeys(e.keys),a=e.keydown,i=e.keypress,o=e.keyup,y=function(e){for(var o=0;o<r.length;o++)if(!t.isOnKey(r[o]))return t.keyMap[n].isPressed=!1,!1;var y=t.keyMap[n].data;return t.keyMap[n].isPressed||(t.keyMap[n].isPressed=!0,a&&a(y)),i&&i(y),!0},s=function(e){for(var a=0;a<r.length;a++)if(!t.isOnKey(r[a])){var i=t.keyMap[n].data;if(t.keyMap[n].isPressed)return t.keyMap[n].isPressed=!1,o&&o(i),!0}return!1};return n&&(this.keyMap[n]=e,this.keyMap[n].keydownImpl=y,this.keyMap[n].keyupImpl=s,this.keyMap[n].isPressed=!1),this.addEventListenerByEventName("keydown",y),this.addEventListenerByEventName("keyup",s),this},KeyMan.prototype.hasShortcut=function(e){var t=this.keyMap[e];return!!t},KeyMan.prototype.delShortcut=function(e){var t=this.keyMap[e];if(t){for(var n=["keydown","keyup"],r=0;r<n.length;r++){var a=n[r],i=n[r]+"Impl";t[i]&&this.removeEventListenerByEventName(a,t[i])}delete this.keyMap[e]}return this},KeyMan.prototype.addCommand=function(e){this.addEventListenerByEventName("saveCommand",plusFuncKeyDown)},KeyMan.prototype.delCommand=function(e){},KeyMan.prototype.lock=function(){},KeyMan.prototype.unlock=function(){},KeyMan.prototype.stop=function(){},KeyMan.prototype.start=function(){},KeyMan.prototype.newShortcutInput=function(e){var t=newEl("input",{type:"text"}).returnElement();return this.addShortcutInput(t,e),t},KeyMan.prototype.addShortcutInput=function(e,t){t=t?t:{};var n=this,r=this.shortcutInputObjs,a=t.manid?t.manid:getEl(r).getNewSeqId("tmpShortcutKeyList"),i=t.id?t.id:e.id?e.id:a;return e.manid=a,e.id=i,r[a]=t,r[a].el=e,r[a].manid=a,getEl(e).addEventListener("focus",function(t){for(var r in n.downedKeyMap)delete n.downedKeyMap[r];n.startPushShortcutInputValue(function(t){n.setShortcutInputValue(e,t," + ")})}).addEventListener("blur",function(e){for(var t in n.downedKeyMap)delete n.downedKeyMap[t];n.stopPushShortcutInputValue()}),a},KeyMan.prototype.getShortcutInputById=function(e){var t=document.getElementById(e);return this.shortcutInputObjs[t.manid].keyList},KeyMan.prototype.getShortcutInputByManId=function(e){return this.shortcutInputObjs[e].keyList},KeyMan.prototype.setShortcutInputValue=function(e,t,n){n=n?n:" + ";var r=this.sortKeyList(t);"string"==typeof e&&(e=document.getElementById(e)),e.value=null!=t?r.join(n):"";var a=e.manid;a&&(this.shortcutInputObjs[a].keyList=r)},KeyMan.prototype.clearShortcutInputValue=function(e){return this.setShortcutInputValue(e,[]),this},KeyMan.prototype.sortKeyList=function(e){var t=["CONTROL","ALT","SHIFT"],n=e.sort(function(e,n){var r=t.indexOf(e),a=t.indexOf(n);return r!=-1&&r<a?0:a!=-1?1:-1});return n},KeyMan.prototype.startPushShortcutInputValue=function(e){var t=this,n=function(n){n.returnValue=!1;var r=Object.keys(t.downedKeyMap),a=t.downedKeyCount,i=r.length;return t.downedKeyCount=i,a<i&&e(r),!0};return this.addEventListenerByEventName("pushshortcut",n),this},KeyMan.prototype.stopPushShortcutInputValue=function(){return this.removeEventListenerByEventName("pushshortcut"),this},KeyMan.prototype.newCommandInput=function(e){var t=newEl("input",{type:"text"}).returnElement();return this.addCommandInput(t,e),t},KeyMan.prototype.addCommandInput=function(e,t){t=t?t:{};var n=this,r=this.commandInputObjs,a=t.manid?t.manid:getEl(r).getNewSeqId("tmpCommandKeyList"),i=t.id?t.id:e.id?e.id:a;return e.manid=a,e.id=i,r[a]=t,r[a].el=e,r[a].manid=a,getEl(e).addEventListener("focus",function(t){for(var r in n.downedKeyMap)delete n.downedKeyMap[r];n.startPushCommandInputValue(function(t){n.setCommandInputValue(e,t," -> ")})}).addEventListener("blur",function(e){for(var t in n.downedKeyMap)delete n.downedKeyMap[t];n.stopPushCommandInputValue()}),a},KeyMan.prototype.getCommandInputById=function(e){var t=getEl(e).returnElement();return this.commandInputObjs[t.manid].keyList},KeyMan.prototype.getCommandInputByManId=function(e){return this.commandInputObjs[e].keyList},KeyMan.prototype.setCommandInputValue=function(e,t,n){n=n?n:" + ";var r=t;e.value=null!=t?r.join(n):"";var a=e.manid;a&&(this.commandInputObjs[a].keyList=r)},KeyMan.prototype.startPushCommandInputValue=function(e){var t=this.addCommander("_input",!0);return t.funcEventWhenCommand=function(t){e(t)},this},KeyMan.prototype.stopPushCommandInputValue=function(){return this.delCommander("_input"),this},KeyMan.prototype.addCommander=function(e,t){var n;return this.getCommander(e)?n=this.getCommander(e):(n=new KeyManCommander(e),n.parent=this,t?(n.keydownFunc=n.handleDefinedKeydown(),n.keyupFunc=n.handleDefinedKeyup()):(n.keydownFunc=n.handleKeydown(),n.keyupFunc=n.handleKeyup()),this.commanders[e]=n,this.addEventListenerByEventName("keydownforcommand",n.keydownFunc),this.addEventListenerByEventName("keyupforcommand",n.keyupFunc)),n},KeyMan.prototype.getCommander=function(e){return this.commanders[e]},KeyMan.prototype.hasCommander=function(e){var t=this.commanders;return e?null!=t[e]&&void 0!=t[e]:null!=t&&void 0!=t&&Object.keys(t).length>0},KeyMan.prototype.delCommander=function(e){var t=this.commanders,n=t[e];return this.removeEventListenerByEventName("keydownforcommand",n.definedKeydownFunc),this.removeEventListenerByEventName("keyupforcommand",n.definedKeyupFunc),delete t[e],this},KeyMan.prototype.delAllCommander=function(){var e=this.commanders;for(var t in e)this.delCommander(t);return this};